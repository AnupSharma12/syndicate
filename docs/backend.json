{
  "entities": {
    "Event": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Event",
      "type": "object",
      "description": "Represents an esports tournament or event.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Event entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the event."
        },
        "description": {
          "type": "string",
          "description": "Detailed description of the event."
        },
        "date": {
          "type": "string",
          "description": "Date and time of the event.",
          "format": "date-time"
        },
        "prize": {
          "type": "number",
          "description": "Prize pool for the event."
        },
        "fee": {
          "type": "number",
          "description": "Registration fee for the event."
        },
        "game": {
          "type": "string",
          "description": "The name of the game for the event."
        },
        "status": {
          "type": "string",
          "description": "The current status of the event registration.",
          "enum": ["Open", "Closed", "Live"]
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "date",
        "prize",
        "fee",
        "game",
        "status"
      ]
    },
    "Game": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Game",
      "type": "object",
      "description": "Represents a specific game or esport title.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Game entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the game or esport title."
        }
      },
      "required": [
        "id",
        "name"
      ]
    },
    "Registration": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Registration",
      "type": "object",
      "description": "Represents a user's registration for a specific event.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Registration entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User entity. (Relationship: User 1:N Registration)"
        },
        "eventId": {
          "type": "string",
          "description": "Reference to the Event entity. (Relationship: Event 1:N Registration)"
        },
        "registrationDate": {
          "type": "string",
          "description": "Date and time of the registration.",
          "format": "date-time"
        },
        "teamName": {
          "type": "string",
          "description": "The name of the registered team."
        },
        "whatsAppNumber": {
          "type": "string",
          "description": "The user's WhatsApp contact number."
        },
        "teamLogoUrl": {
          "type": "string",
          "description": "URL to the team's logo. Placeholder for file upload functionality."
        },
        "paymentProofUrl": {
          "type": "string",
          "description": "URL to the payment proof screenshot. Placeholder for file upload functionality."
        },
        "youtubeProofUrl": {
          "type": "string",
          "description": "URL to the YouTube subscription screenshot. Placeholder for file upload functionality."
        }
      },
      "required": [
        "id",
        "userId",
        "eventId",
        "registrationDate",
        "teamName",
        "whatsAppNumber"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity, corresponding to Firebase Auth UID."
        },
        "username": {
          "type": "string",
          "description": "Username of the user."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "staff": {
          "type": "boolean",
          "description": "Flag indicating whether the user is a staff member.",
          "default": false
        }
      },
      "required": [
        "id",
        "email"
      ]
    },
    "Log": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Log",
      "type": "object",
      "description": "Represents a system log entry.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Log entity."
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp of the log entry.",
          "format": "date-time"
        },
        "level": {
          "type": "string",
          "description": "Log level (e.g., INFO, WARNING, ERROR)."
        },
        "message": {
          "type": "string",
          "description": "Log message."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User entity that triggered the log. (Relationship: User 1:N Log)"
        }
      },
      "required": [
        "id",
        "timestamp",
        "level",
        "message",
        "userId"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
       {
        "path": "/events/{eventId}",
        "definition": {
          "entityName": "Event",
          "schema": {
            "$ref": "#/backend/entities/Event"
          },
          "description": "Collection of all events.",
          "params": [
            {
              "name": "eventId",
              "description": "The unique identifier for the event."
            }
          ]
        }
      },
      {
        "path": "/games/{gameId}",
        "definition": {
          "entityName": "Game",
          "schema": {
            "$ref": "#/backend/entities/Game"
          },
          "description": "Collection of games, each identified by gameId.",
          "params": [
            {
              "name": "gameId",
              "description": "The unique identifier for the game."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Collection of users, each identified by userId. Includes denormalized 'staff' field for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/registrations/{registrationId}",
        "definition": {
          "entityName": "Registration",
          "schema": {
            "$ref": "#/backend/entities/Registration"
          },
          "description": "Collection of registrations for a specific user, each identified by registrationId.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "registrationId",
              "description": "The unique identifier for the registration."
            }
          ]
        }
      },
      {
        "path": "/logs/{logId}",
        "definition": {
          "entityName": "Log",
          "schema": {
            "$ref": "#/backend/entities/Log"
          },
          "description": "Collection of system logs, each identified by logId.",
          "params": [
            {
              "name": "logId",
              "description": "The unique identifier for the log entry."
            }
          ]
        }
      },
      {
        "path": "/roles_staff/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Collection of staff user roles, each identified by userId. The existence of a document signifies staff privileges.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to support the Syndicate ESP application, focusing on secure access to admin functionalities, event management, user registrations, and activity logging. Key considerations include authorization independence, clear security intent, and the ability to perform secure list operations. The design incorporates Structural Segregation to ensure that collections contain documents with similar security requirements. The structure is optimised for the application requirements and is as follows:\n\n1.  **Staff Roles:** The `/roles_staff/{userId}` collection is used to manage staff privileges. The existence of a document for a given user ID in this collection indicates that the user is a staff member. This approach simplifies the security rules and avoids relying on custom claims (DBAC).\n\n2.  **Events:** Events are stored in a top-level `/events` collection to simplify queries. This is more efficient than nesting them under games, especially for fetching all upcoming events.\n\n3.  **Registrations:** Registrations are stored under the `/users/{userId}/registrations/{registrationId}` collection. This hierarchical structure ensures that each user's registrations are scoped to their user ID. This approach is secure and efficient for querying registrations for a specific user.\n\n4.  **Logs:** The `/logs/{logId}` collection stores log entries. Since admin access is required, there is no need to associate logs with user; this collection can exist at the root level.\n\n**Authorization Independence (Denormalization):**\n\n*   To ensure Authorization Independence, the `staff` field is denormalized into the `User` document. This eliminates the need for security rules to perform `get()` operations to verify staff status. For accessing admin-related functions, the security rules check for the existence of the `staff` field in the user's document, adhering to the existence-over-content principle.\n\n**QAPs (Rules are not Filters):**\n\n*   The structure enables secure `list` operations. Public data (e.g., events) and private data (e.g., user registrations) are stored in separate collections, each with its own security rules. This segregation makes it easy to write rules that allow listing public data while restricting access to private data.\n\n*   The `/roles_staff` collection allows administrators to list the staff roles collection."
  }
}
